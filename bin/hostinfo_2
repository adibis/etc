#!/bin/bash
#
# info.sh - displays info about wm, font, gtk theme
# copied from z3bra's blog
#

c00=$'\e[0;30m'
c01=$'\e[0;31m'
c02=$'\e[0;32m'
c03=$'\e[0;33m'
c04=$'\e[0;34m'
c05=$'\e[0;35m'
c06=$'\e[0;36m'
c07=$'\e[0;37m'
c08=$'\e[1;30m'
c09=$'\e[1;31m'
c10=$'\e[1;32m'
c11=$'\e[1;33m'
c12=$'\e[1;34m'
c13=$'\e[1;35m'
c14=$'\e[1;36m'
c15=$'\e[1;37m'

f0=$'\e[1;30m'
f1=$'\e[1;37m'
f2=$'\e[0;37m'

kernel=$(uname -rmo)
system=$(sed 's/\s*[\(\\]\+.*$//' /etc/issue)

if [[ -n $DISPLAY ]]; then
    fon=$(xrdb -query | sed -n 's/^.*\*faceName:\s*//p' | cut -f 1 -d ":")
    if [[ $fon =~ "xft" ]]; then
        termfn=$(echo $fon | awk -F ':' '{print $2}')
    else
        termfn=$(echo $fon | sed -re 's/^-\w+-(\w+)-.*/\1/')
    fi
    termsz=$(xrdb -query | sed -n 's/^.*\*faceName:\s*//p' | cut -f 2 -d "=")
else
    termfn="none"
    systfn="none"
fi

booted=`awk '// {
	sec = int($1)
	days = int(sec/3600/24)
	sec -= days*24*3600
	hours = int(sec/3600)
	sec -= hours*3600
	mins = int(sec/60)
	sec -= mins*60
	secs = int(sec)
	printf "%i days, %i:%i:%i",days, hours, mins, secs;
	}' /proc/uptime`


pkgnum=$(pacman -Q | wc -l)
birthd=$(sed -n '1s/^\[\([0-9-]*\).*$/\1/p' /var/log/pacman.log | tr - .)

battstat=$(acpi | awk '{print $3}')
battper=$(acpi | awk '{print $4}')
battpern=$(acpi | awk '{print $4}' | cut -f 1 -d "%")
battremain=$(acpi | awk '{print $5}')

CPU=$(cat /proc/cpuinfo | grep "model name" | sed 's/^.*: //' | head -n 1)

RAM=$(free -h | grep Mem: | awk '{print $3}')
RAMf=$(free -h | grep Mem: | awk '{print $2}')
RAMp=$(free -m | grep Mem: | awk '{print $3}')

rspaceu=$(df --total -h | grep sda5 | awk '{print $3}')
rspacet=$(df --total -h | grep sda5 | awk '{print $2}')
rspacep=$(df --total -h | grep sda5 | awk '{print $5}' | cut -f 1 -d "%")

hspaceu=$(df --total -h | grep home | awk '{print $3}')
hspacet=$(df --total -h | grep home | awk '{print $2}')
hspacep=$(df --total -h | grep home | awk '{print $5}' | cut -f 1 -d "%")

nspaceu=$(df --total -h | grep sdb1 | awk '{print $3}')
nspacet=$(df --total -h | grep sdb1 | awk '{print $2}')
nspacep=$(df --total -h | grep sdb1 | awk '{print $5}' | cut -f 1 -d "%")

if [ $rspacep -gt 90 ]; then
    f3=$'\e[1;31m'
else
    if [ $rspacep -gt 75 ]; then
        f3=$'\e[1;33m'
    else
        f3=$'\e[1;32m'
    fi
fi

if [ $hspacep -gt 90 ]; then
    f4=$'\e[1;31m'
else
    if [ $hspacep -gt 75 ]; then
        f4=$'\e[1;33m'
    else
        f4=$'\e[1;32m'
    fi
fi

if [[ $nspacep == ?(-)+([0-9]) ]]; then
  if [ $nspacep -gt 90 ]; then
      f6=$'\e[1;31m'
  else
      if [ $nspacep -gt 75 ]; then
          f6=$'\e[1;33m'
      else
          f6=$'\e[1;32m'
      fi
  fi
fi

if [ $RAMp -gt 6000 ]; then
    f5=$'\e[1;31m'
else
    if [ $RAMp -gt 4000 ]; then
        f5=$'\e[1;33m'
    else
        if [ $RAMp -gt 2000 ]; then
            f5=$'\e[1;32m'
        else
            f5=$'\e[0;37m'
        fi
    fi
fi

if [ $battpern -lt 40 ]; then
    f6=$'\e[1;31m'
else
    if [ $battpern -lt 70 ]; then
        f6=$'\e[1;33m'
    else
        if [ $battpern -lt 85 ]; then
            f6=$'\e[1;32m'
        else
            f6=$'\e[0;37m'
        fi
    fi
fi


cat << EOF


    ${c00}▉▉  |
    ${c08}  ▉▉| ${f1}OS ${f0}........... $f2$system
    ${c01}▉▉  | ${f1}user ${f0}......... $f2$USER@$HOSTNAME
    ${c09}  ▉▉| ${f1}birth day${f0}..... $f2$birthd
    ${c02}▉▉  | ${f1}packages ${f0}..... $f2$pkgnum
    ${c10}  ▉▉|
    ${c03}▉▉  | ${f1}kernel ${f0}....... $f2$kernel
    ${c11}  ▉▉| ${f1}shell ${f0}........ $f2$SHELL
    ${c04}▉▉  | ${f1}terminal ${f0}..... $f2$TERM
    ${c12}  ▉▉| ${f1}term font ${f0}.... $f2$termfn, $f2$termsz
    ${c05}▉▉  |
    ${c13}  ▉▉| ${f1}uptime ${f0}....... $f2$booted
    ${c06}▉▉  | ${f1}battery ${f0}...... $f6$battstat $battper $f2$battremain
    ${c14}  ▉▉| ${f1}cpu ${f0}.......... $f2$CPU
    ${c07}▉▉  | ${f1}ram ${f0}.......... ${f5}$RAM $f2/ $RAMf
    ${c15}  ▉▉| ${f1}disk ${f0}......... ${f2}root: $f3$rspaceu $f2/ $rspacet, home: $f4$hspaceu $f2/ $hspacet, aux: $f6$nspaceu $f2/ $nspacet


EOF
